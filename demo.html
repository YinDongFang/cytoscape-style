<!DOCTYPE>

<html>

  <head>
    <title>cytoscape-fcose.js demo</title>

      <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">

      <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
      <script src="https://code.jquery.com/jquery-3.0.0.min.js" crossorigin="anonymous"></script>
      <script src="https://unpkg.com/numeric/numeric-1.2.6.js"></script>
      <script src="https://raw.githack.com/iVis-at-Bilkent/layout-base/unstable/layout-base.js"></script>
      <script src="https://raw.githack.com/cytoscape/cytoscape.js-cose-bilkent/unstable/cytoscape-cose-bilkent.js"></script>
      <script src="cytoscape-graphml.js"></script>
      <script src="cytoscape-tsv.js"></script>

      <!-- for testing with local version of cytoscape.js -->
      <!--<script src="../cytoscape.js/build/cytoscape.js"></script>-->

      <script src="cytoscape-fcose.js"></script>

      <style>
        body {
          font-family: helvetica neue, helvetica, liberation sans, arial, sans-serif;
          font-size: 14px;
        }

        #cy {
          position: relative;
          width: 100%;
          height: 85%;
          z-index: 999;
        }

        h1 {
          opacity: 0.5;
          font-size: 1em;
          font-weight: bold;
        }
      </style>

      <script>
        document.addEventListener('DOMContentLoaded', function(){

          var cy = window.cy = cytoscape({
            container: document.getElementById('cy'),

            // demo your layout
            layout: {
              name: 'fcose',
              postProcessing: document.getElementById("post").checked ? true : false,
              initialEnergyOnIncremental: document.getElementById("energy").value
              // some more options here...
            },

            style: [
              {
                selector: 'node',
                style: {
                  'content': 'data(id)',
                }
              },

              {
                selector: 'edge',
                style: {
                  //'width': 0.1
                }
              }
            ],

            elements: {
              nodes: [
                { data: { id: 'n0'} },
                { data: { id: 'n1'} },
                { data: { id: 'n2'} },
                { data: { id: 'n3'} },
                { data: { id: 'n4'} },
                { data: { id: 'n5'} },
                { data: { id: 'n6'} },
                { data: { id: 'n7'} },
                { data: { id: 'n8'} }                                                 
              ],
              edges: [
                { data: { source: 'n0', target: 'n1' } },
                { data: { source: 'n1', target: 'n2' } },
                { data: { source: 'n3', target: 'n4' } },
                { data: { source: 'n4', target: 'n5' } },
                { data: { source: 'n6', target: 'n7' } },
                { data: { source: 'n7', target: 'n8' } },
                { data: { source: 'n0', target: 'n3' } },
                { data: { source: 'n3', target: 'n6' } },
                { data: { source: 'n1', target: 'n4' } },
                { data: { source: 'n4', target: 'n7' } },
                { data: { source: 'n2', target: 'n5' } },
                { data: { source: 'n5', target: 'n8' } }
              ]
            }
          });

          document.getElementById("nodes").innerHTML = cy.nodes().length;
          document.getElementById("edges").innerHTML = cy.edges().length;
          
          document.getElementById("CMDSlayoutButton").addEventListener("click", function(){
            var layout = cy.layout({
              name: 'fcose',
              postProcessing: document.getElementById("post").checked ? true : false,
              initialEnergyOnIncremental: document.getElementById("energy").value
            });
            
            layout.run();        
          });
          
          document.getElementById("CoSEButton").addEventListener("click", function(){
            var layout = cy.layout({
              name: 'cose-bilkent',
            });
            var runtime = performance.now();
            layout.run();
            runtime = performance.now() - runtime;
            
            document.getElementById("totalCose").innerHTML = Math.floor(runtime) + " ms";
          });          
          
          document.getElementById('input').addEventListener("change", function() {
            var inputFile = this.files[0];
            if (inputFile) {
              var fileExtension = inputFile.name.split('.').pop();
              var r = new FileReader();
              r.onload = function(e) {
                cy.remove(cy.elements());
                var content = e.target.result;
                if(fileExtension == "graphml" || fileExtension == "xml"){
                  cy.graphml(content);
                  document.getElementById("nodes").innerHTML = cy.nodes().length;
                  document.getElementById("edges").innerHTML = cy.edges().length;
                }
                else{  
                  var tsv = cy.tsv();
                  tsv.importTo(content);
                  document.getElementById("nodes").innerHTML = cy.nodes().length;
                  document.getElementById("edges").innerHTML = cy.edges().length;
                }
            }
              r.readAsText(inputFile);
            } else { 
              alert("Failed to load file");
            }
          }, true);


        });
      </script>
  </head>

  <body>
          <h1>cytoscape-fcose demo</h1>

          <input type="file" id="input" style="margin-bottom: 5px">
          Nodes: <span id="nodes"></span>&nbsp &nbsp
          Edges: <span id="edges"></span><br>
          
          <button id="CMDSlayoutButton" type="button" style="margin-bottom: 5px">fcose</button>
          <label for="layout" style="vertical-align:middle;">Post-processing</label>
          <input type="checkbox" id="post" name="layout" style="vertical-align:middle;" checked>
          Initial Energy: <input type="text" id="energy" value="0.2" size="2">
          <b>Spectral: </b><span id="spectral"></span>
          <b>Post-processing: </b><span id="cose"></span>
          <b>Total: </b><span id="total"></span><br>  
          
          <button id="CoSEButton" type="button" style="margin-bottom: 5px">CoSE</button>      
          <b>Total: </b><span id="totalCose">N/A</span><br>
      
          <div id="cy"></div>

  </body>

</html>
