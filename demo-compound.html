<!DOCTYPE>

<html>

  <head>
    <title>cytoscape-fcose.js demo</title>

      <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">

      <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
      <script src="https://code.jquery.com/jquery-3.0.0.min.js" crossorigin="anonymous"></script>
      <script src="https://unpkg.com/numeric/numeric-1.2.6.js"></script>
      <script src="https://raw.githack.com/iVis-at-Bilkent/layout-base/unstable/layout-base.js"></script>
      <script src="https://raw.githack.com/iVis-at-Bilkent/cose-base/unstable/cose-base.js"></script>
      <script src="https://raw.githack.com/cytoscape/cytoscape.js-cose-bilkent/unstable/cytoscape-cose-bilkent.js"></script>
      <script src="cytoscape-graphml.js"></script>
      <script src="cytoscape-tsv.js"></script>

      <!-- for testing with local version of cytoscape.js -->
      <!--<script src="../cytoscape.js/build/cytoscape.js"></script>-->

      <script src="cytoscape-fcose.js"></script>

      <style>
        body {
          font-family: helvetica neue, helvetica, liberation sans, arial, sans-serif;
          font-size: 14px;
        }

        #cy {
          position: relative;
          width: 100%;
          height: 85%;
          z-index: 999;
        }

        h1 {
          opacity: 0.5;
          font-size: 1em;
          font-weight: bold;
        }
      </style>

      <script>
        document.addEventListener('DOMContentLoaded', function(){

          var cy = window.cy = cytoscape({
            container: document.getElementById('cy'),

            // demo your layout
            layout: {
              name: 'cose-bilkent'
            },

            style: [
              {
                selector: 'node',
                style: {
                  'content': 'data(id)',
                }
              },

              {
                selector: 'edge',
                style: {
                  //'width': 0.1
                }
              }
            ],
            /*
            elements: {
              nodes: [
                { data: { id: 'n0'} },
                { data: { id: 'n1'} },
                { data: { id: 'n2'} },
                { data: { id: 'n3'} },
                { data: { id: 'n4'} },
                { data: { id: 'n5', parent: 'n0'} },
                { data: { id: 'n6', parent: 'n0'} },
                { data: { id: 'n7', parent: 'n0'} }                                               
              ],
              edges: [
                { data: { source: 'n0', target: 'n2' } },
                { data: { source: 'n0', target: 'n4' } },
                { data: { source: 'n1', target: 'n5' } },
                { data: { source: 'n3', target: 'n7' } },
                { data: { source: 'n5', target: 'n6' } },
                { data: { source: 'n5', target: 'n7' } },
                { data: { source: 'n6', target: 'n7' } }
              ]
            }            
            */
            elements: [{ group:'nodes', data:{ id: 'n0'}},
                    { group:'nodes', data:{ id: 'n1'}},
                    { group:'nodes', data:{ id: 'n2'}},
                    { group:'nodes', data:{ id: 'n3'}},
                    { group:'nodes', data:{ id: 'n4', parent: 'n37'}},
                    { group:'nodes', data:{ id: 'n5'}},
                    { group:'nodes', data:{ id: 'n6'}},
                    { group:'nodes', data:{ id: 'n7', parent: 'n37'}},
                    { group:'nodes', data:{ id: 'n8', parent: 'n37'}},
                    { group:'nodes', data:{ id: 'n9', parent: 'n37'}},
                    { group:'nodes', data:{ id: 'n10', parent: 'n38'}},
                    { group:'nodes', data:{ id: 'n12'}},
                    { group:'nodes', data:{ id: 'n13'}},
                    { group:'nodes', data:{ id: 'n14'}},
                    { group:'nodes', data:{ id: 'n15'}},
                    { group:'nodes', data:{ id: 'n16'}},
                    { group:'nodes', data:{ id: 'n17'}},
                    { group:'nodes', data:{ id: 'n18'}},
                    { group:'nodes', data:{ id: 'n19'}},
                    { group:'nodes', data:{ id: 'n20'}},
                    { group:'nodes', data:{ id: 'n21'}},
                    { group:'nodes', data:{ id: 'n22'}},
                    { group:'nodes', data:{ id: 'n23'}},
                    { group:'nodes', data:{ id: 'n24', parent: 'n39'}},
                    { group:'nodes', data:{ id: 'n25', parent: 'n39'}},
                    { group:'nodes', data:{ id: 'n26', parent: 'n42'}},
                    { group:'nodes', data:{ id: 'n27', parent: 'n42'}},
                    { group:'nodes', data:{ id: 'n28', parent: 'n42'}},
                    { group:'nodes', data:{ id: 'n29', parent: 'n40'}},
                    { group:'nodes', data:{ id: 'n31', parent: 'n41'}},
                    { group:'nodes', data:{ id: 'n32', parent: 'n41'}},
                    { group:'nodes', data:{ id: 'n33', parent: 'n41'}},
                    { group:'nodes', data:{ id: 'n34', parent: 'n41'}},
                    { group:'nodes', data:{ id: 'n35', parent: 'n41'}},
                    { group:'nodes', data:{ id: 'n36', parent: 'n41'}},
                    { group:'nodes', data:{ id: 'n37'}},
                    { group:'nodes', data:{ id: 'n38'}},
                    { group:'nodes', data:{ id: 'n39', parent: 'n43'}},
                    { group:'nodes', data:{ id: 'n40', parent: 'n42'}},
                    { group:'nodes', data:{ id: 'n41', parent: 'n42'}},
                    { group:'nodes', data:{ id: 'n42', parent: 'n43'}},
                    { group:'nodes', data:{ id: 'n43'}},
                    { group:'edges', data:{ id: 'e0', source: 'n0', target: 'n1'} },
                    { group:'edges', data:{ id: 'e1', source: 'n1', target: 'n2'} },
                    { group:'edges', data:{ id: 'e2', source: 'n2', target: 'n3'} },
                    { group:'edges', data:{ id: 'e3', source: 'n0', target: 'n3'} },
                    { group:'edges', data:{ id: 'e4', source: 'n1', target: 'n4'} },
                    { group:'edges', data:{ id: 'e5', source: 'n2', target: 'n4'} },
                    { group:'edges', data:{ id: 'e6', source: 'n4', target: 'n5'} },
                    { group:'edges', data:{ id: 'e7', source: 'n5', target: 'n6'} },
                    { group:'edges', data:{ id: 'e8', source: 'n4', target: 'n6'} },
                    { group:'edges', data:{ id: 'e9', source: 'n4', target: 'n7'} },
                    { group:'edges', data:{ id: 'e10', source: 'n7', target: 'n8'} },
                    { group:'edges', data:{ id: 'e11', source: 'n8', target: 'n9'} },
                    { group:'edges', data:{ id: 'e12', source: 'n7', target: 'n9'} },
                    { group:'edges', data:{ id: 'e13', source: 'n13', target: 'n14'} },
                    { group:'edges', data:{ id: 'e14', source: 'n12', target: 'n14'} },
                    { group:'edges', data:{ id: 'e15', source: 'n14', target: 'n15'} },
                    { group:'edges', data:{ id: 'e16', source: 'n14', target: 'n16'} },
                    { group:'edges', data:{ id: 'e17', source: 'n15', target: 'n17'} },
                    { group:'edges', data:{ id: 'e18', source: 'n17', target: 'n18'} },
                    { group:'edges', data:{ id: 'e19', source: 'n18', target: 'n19'} },
                    { group:'edges', data:{ id: 'e20', source: 'n17', target: 'n20'} },
                    { group:'edges', data:{ id: 'e21', source: 'n19', target: 'n20'} },
                    { group:'edges', data:{ id: 'e22', source: 'n16', target: 'n20'} },
                    { group:'edges', data:{ id: 'e23', source: 'n20', target: 'n21'} },
                    { group:'edges', data:{ id: 'e24', source: 'n22', target: 'n24'} },
                    { group:'edges', data:{ id: 'e25', source: 'n23', target: 'n24'} },
                    { group:'edges', data:{ id: 'e26', source: 'n24', target: 'n25'} },
                    { group:'edges', data:{ id: 'e27', source: 'n26', target: 'n38'} },
                    { group:'edges', data:{ id: 'e28', source: 'n26', target: 'n37'} },
                    { group:'edges', data:{ id: 'e29', source: 'n26', target: 'n39'} },
                    { group:'edges', data:{ id: 'e30', source: 'n26', target: 'n27'} },
                    { group:'edges', data:{ id: 'e31', source: 'n26', target: 'n28'} },
                    { group:'edges', data:{ id: 'e32', source: 'n26', target: 'n40'} },
                    { group:'edges', data:{ id: 'e33', source: 'n21', target: 'n31'} },
                    { group:'edges', data:{ id: 'e34', source: 'n21', target: 'n32'} },
                    { group:'edges', data:{ id: 'e35', source: 'n31', target: 'n33'} },
                    { group:'edges', data:{ id: 'e36', source: 'n31', target: 'n34'} },
                    { group:'edges', data:{ id: 'e37', source: 'n33', target: 'n34'} },
                    { group:'edges', data:{ id: 'e38', source: 'n32', target: 'n35'} },
                    { group:'edges', data:{ id: 'e39', source: 'n32', target: 'n36'} },
                    { group:'edges', data:{ id: 'e40', source: 'n16', target: 'n40'} }
                   ]
          });

          document.getElementById("nodes").innerHTML = cy.nodes().length;
          document.getElementById("edges").innerHTML = cy.edges().length;
          
          document.getElementById("CMDSlayoutButton").addEventListener("click", function(){
            var layout = cy.layout({
              name: 'fcose',
              postProcessing: document.getElementById("post").checked ? true : false,
              initialEnergyOnIncremental: document.getElementById("energy").value
            });
            
            layout.run();        
          });
          
          document.getElementById("CoSEButton").addEventListener("click", function(){
            var layout = cy.layout({
              name: 'cose-bilkent',
            });
            var runtime = performance.now();
            layout.run();
            runtime = performance.now() - runtime;
            
            document.getElementById("totalCose").innerHTML = Math.floor(runtime) + " ms";
          });          
          
          document.getElementById('input').addEventListener("change", function() {
            var inputFile = this.files[0];
            if (inputFile) {
              var fileExtension = inputFile.name.split('.').pop();
              var r = new FileReader();
              r.onload = function(e) {
                cy.remove(cy.elements());
                var content = e.target.result;
                if(fileExtension == "graphml" || fileExtension == "xml"){
                  cy.graphml(content);
                  document.getElementById("nodes").innerHTML = cy.nodes().length;
                  document.getElementById("edges").innerHTML = cy.edges().length;
                }
                else{  
                  var tsv = cy.tsv();
                  tsv.importTo(content);
                  document.getElementById("nodes").innerHTML = cy.nodes().length;
                  document.getElementById("edges").innerHTML = cy.edges().length;
                }
            }
              r.readAsText(inputFile);
            } else { 
              alert("Failed to load file");
            }
          }, true);


        });
      </script>
  </head>

  <body>
          <h1>cytoscape-fcose demo</h1>

          <input type="file" id="input" style="margin-bottom: 5px">
          Nodes: <span id="nodes"></span>&nbsp &nbsp
          Edges: <span id="edges"></span><br>
          
          <button id="CMDSlayoutButton" type="button" style="margin-bottom: 5px">fcose</button>
          <label for="layout" style="vertical-align:middle;">Post-processing</label>
          <input type="checkbox" id="post" name="layout" style="vertical-align:middle;" checked>
          Initial Energy: <input type="text" id="energy" value="0.2" size="2">
          <b>Spectral: </b><span id="spectral"></span>
          <b>Post-processing: </b><span id="cose"></span>
          <b>Total: </b><span id="total"></span><br>  
          
          <button id="CoSEButton" type="button" style="margin-bottom: 5px">CoSE</button>      
          <b>Total: </b><span id="totalCose">N/A</span><br>
      
          <div id="cy"></div>

  </body>

</html>
